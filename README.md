# Prompt Injection Game (PIG)

- Frontend:
  - [Next.js](https://github.com/vercel/next.js) - a React framework for production.
  - [Tailwind](https://tailwindcss.com/) for styling and layout.
  - [Supabase.js](https://supabase.com/docs/library/getting-started) for user management and realtime data syncing.
- Backend:
  - [app.supabase.com](https://app.supabase.com/): hosted Postgres database with restful API for usage with Supabase.js.
  - Open AI as the LLM model (requires API key)
  - PineCone as vector DB (requires API key)

## Getting started

1. Sign up to Supabase, PineCone and OpenAI and make a note of your API keys
2. `cp .env-template .env` and fill in your API keys and other configs.

## Supabase setup

We use Supabase for both Auth and our backend Postgres DB.

For the DB, you'll need 3 tables in the public schema

```sql
create table
  public.attempts_log (
    id bigint generated by default as identity not null,
    created_at timestamp with time zone null default now(),
    user_id uuid null,
    stage smallint null,
    attempt integer null,
    input character varying null,
    output character varying null,
    detector character varying null,
    is_injection boolean null,
    constraint attempts_log_pkey primary key (id)
  ) tablespace pg_default;

create table
  public.games (
    id bigint generated by default as identity not null,
    user_id uuid not null,
    attempts smallint not null default '0'::smallint,
    level smallint not null default '0'::smallint,
    created_at timestamp with time zone not null default now(),
    success boolean null,
    constraint Games_pkey primary key (id),
    constraint games_user_id_key unique (user_id),
    constraint games_user_id_fkey foreign key (user_id) references auth.users (id) on delete cascade
  ) tablespace pg_default;

create table
  public.profiles (
    id uuid not null,
    created_at timestamp with time zone null default now(),
    username character varying null,
    constraint profiles_pkey primary key (id),
    constraint profiles_id_fkey foreign key (id) references auth.users (id) on delete cascade
  ) tablespace pg_default;
```

You will need to add [RLS policies](https://supabase.com/docs/learn/auth-deep-dive/auth-row-level-security) to the `profiles` and `games` tables. The frontend should have no access to `attempts_log` to preserve the integrity of your leaderboard and game play.

## Authors

- [Willem](https://github.com/woop)
- [Shahram](https://github.com/shrumm)
- [Zhiling](https://github.com/zhilingc)
